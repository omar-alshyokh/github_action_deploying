name: Build & deploy iOS app for an environment

on:
  push:
    branches:
      - dev
    tags:
      - '*-android'

jobs:
  build:
    runs-on: macos-latest
    environment: production
    steps:
      # Checks-out our repository under $GITHUB_WORKSPACE, so our job can access it
      - name: Checkout repository
        uses: actions/checkout@v2

      # Install  Apple certificate and provisioning profile
      - name: 📝🔐 Create keystore.properties file & .env
        id: build-android
        env:
          KEYSTORE: ${{ secrets.KEYSTORE_PASS }}
          KEYSTORE_KEY_PASS: ${{ secrets.KEYSTORE_KEY_PASS }}
          KEYSTORE_KEY_ALIAS: ${{ secrets.KEYSTORE_KEY_ALIAS }}
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          MAVEN_USERNAME: ${{ secrets.MAVEN_USERNAME }}
          MAVEN_PASSWORD: ${{ secrets.MAVEN_PASSWORD }}
        run:
          echo "storePassword=$KEYSTORE" >> android/key.properties;
          echo "keyPassword=$KEYSTORE_KEY_PASS" >> android/key.properties;
          echo "keyAlias=$KEYSTORE_KEY_ALIAS" >> android/key.properties;
          echo "storeFile=keystore.jks" >> android/key.properties;
          echo "MAVEN_PASSWORD=$MAVEN_PASSWORD" >> android/local.properties;
          echo "MAVEN_USERNAME=$MAVEN_USERNAME" >> android/local.properties;

      - name: Save Artifact
        uses: actions/upload-artifact@v2
        with:
          name: app-bundle
          path: android/key.properties
